// Connor S. Murray, PhD
// Started: 12.17.2025
// A nextflow pipeline for simulating HiFi reads and detecting viral integrations

// Paramters for pipeline
params {
    help = false

    // Input genomes
    host_genome = "/work/c0murr09/human_genome/chr22_middle_5Mb.fa"
    viral_genome = "/work/c0murr09/viral_genome/GCA_003190765.1_ASM319076v1_genomic.fna"
    viral_genomes = "/work/c0murr09/viral_genome/hiv_genome_panal/*fasta"

    // Patient samples (set to skip simulation)
    patient_dir = "/work/c0murr09/raw_data/stc1621/1621_pool4/hifi_reads/"  // Directory containing patient BAM/FASTQ files, set to skip simulation
    patient_bam = null  // Legacy: single patient BAM file (deprecated, use patient_dir instead)

    // Integration parameters (If running simulation)
    n_integrations = 10
    target_chroms = null
    seed = null

    // pbsim3 parameters
    depth = 30
    length_mean = 15000
    accuracy_mean = 0.99
    pbsim_model = "/opt/pbsim3/data/QSHMM-RSII.model" // This is within the apptainer image

    // fastp parameters
    fastp_qual = 15  // Minimum quality score
    fastp_min_length = 1000  // Minimum read length after trimming
    fastp_adapters = null  // Path to adapter FASTA file (null = auto-detect)

    // Picard parameters
    picard_max_records = 500000  // Max records in RAM for MarkDuplicates

    // Output
    outdir = './output'

    // SLURM
    partition = 'cpu384g'
    threads = 16
    memory = '30 GB'
}

// Define profiles for slurm execution environment
profiles {
    slurm {
        process {
            executor = 'slurm' // Use SLURM as the executor
            clusterOptions = "--partition=${params.partition}" // SLURM partition, account
            cpus = "${params.threads}" // Number of threads per job
            memory = "${params.memory}" // Memory per job
            errorStrategy = 'finish'
        }
    }
}

// Container parameters (keep at end of config - nf can be particular...)
apptainer.enabled = true
apptainer.autoMounts = true
apptainer.pullTimeout  = '20m'